<?php 
//  $_SESSION['encryptedLoginName'] =  '5c9930fcf66bf5d4fe8803db86387a427b56b013452be0c765b9011d179c105f38f590019b05ee1503dcf5ed29dcda81b9b641603b34cf7a927c9f3e5fc8202b6db9e4d7b9963d75994f8623a46d5971f80b5d186cd982a87ad7bb134834bfa732939c06e523e1ca81d161e6d628c7da0adc290832d191d5c66f9aa80b9a7097';
//  $_SESSION['encryptedPassWord'] =  '5aaae845004b40e1133f7c7428500e11836b648aebf3dbbf22b6a570649c3b0db7d4bc47c5a28b7a7ba3f1fac7e5cc4e9b1a0efce66627db241a15a1b9e1f7662432509ac9493d52bfdbc055fa8ab7730a89749aa75bc8fb6f76fff5cefdc95c82fc6dc69a8fc187e238b1b9cdbfcd226e730c19e99d708d92e3960517c9bd79';
 
if(!isset($_POST['encryptedLoginName'])){
  //session_start();
//   $_SESSION['encryptedLoginName'] =  $_POST['encryptedLoginName'];
//   $_SESSION['encryptedPassWord'] =  $_POST['encryptedPassWord'];
}else{
   
$time = round(microtime(true) * 1000); ?>
<script type="text/javascript" src="https://www.11st.co.kr/js/common/rsa.js?noCache=<?=$time?>"></script>
<form name="login_form" method="POST" action="">
        <input type="hidden" id="encryptedLoginName" name="encryptedLoginName" value="">
        <input type="hidden" id="encryptedPassWord" name="encryptedPassWord" value="">
        <input type="hidden" id="priority" name="priority" value="">
        <input type="hidden" name="authMethod" value="login">
        <input type="hidden" name="returnURL" value="">
        <input type="hidden" name="loginName" id="user-id"  value="ysjlabs">
        <input type="hidden" id="passWord" name="passWord" value='yakeun87!@' >

</form>
<script>
function checkForm() {
    var form = document.login_form;
   
    try {
        if(rsa){

            try{
                form.priority.value=96;
                form.encryptedLoginName.value=rsa.encrypt('ysjlabs');
                form.encryptedPassWord.value=rsa.encrypt('yakeun87!@');
                form.loginName.value = "";
                form.passWord.value = "";
            }catch(ex){
                Logger.LoggingMsg('ID/PW RSA encrypt 오류');
            }
        }
    } catch(ex){
        Logger.LoggingMsg('로그인 자바스크립트 오류');
    }

    form.submit();
}
checkForm();
</script>
<?php }?>
<?php
require PATH_ROOT . '/vendor1/autoload.php';
use Goutte\Client;
use Symfony\Component\HttpClient\HttpClient;
use Symfony\Component\BrowserKit\HttpBrowser;
use Symfony\Component\DomCrawler\Crawler;

require PATH_ROOT . '/vendor/autoload.php';
use Google\Cloud\Storage\StorageClient;
class St11stController extends Controller {
    
    // Phương thức khởi tạo
    public function __construct($params) {
        parent::__construct($params);
    }
 
    // Phương thức index
    public function indexAction($start_date = null, $end_date = null) {
        if ($start_date == null && $end_date == null) {
            $start_date = (date("Y") - 1)  . date("md");
            $end_date = date("Ymd");
        }

        $client = new Client(HttpClient::create(['timeout' => 60]));
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/login.tmall?returnURL=http://soffice.11st.co.kr');
        
        $form = $crawler->selectButton("로그인")->form();
        $crawler = $client->submit($form, array(
            'encryptedLoginName' => '5c9930fcf66bf5d4fe8803db86387a427b56b013452be0c765b9011d179c105f38f590019b05ee1503dcf5ed29dcda81b9b641603b34cf7a927c9f3e5fc8202b6db9e4d7b9963d75994f8623a46d5971f80b5d186cd982a87ad7bb134834bfa732939c06e523e1ca81d161e6d628c7da0adc290832d191d5c66f9aa80b9a7097',
            'encryptedPassWord' => '5aaae845004b40e1133f7c7428500e11836b648aebf3dbbf22b6a570649c3b0db7d4bc47c5a28b7a7ba3f1fac7e5cc4e9b1a0efce66627db241a15a1b9e1f7662432509ac9493d52bfdbc055fa8ab7730a89749aa75bc8fb6f76fff5cefdc95c82fc6dc69a8fc187e238b1b9cdbfcd226e730c19e99d708d92e3960517c9bd79',
            'loginName' => 'ysjlabs',
            'passWord' => 'yakeun87!@'));
        $data = [
            'encryptedLoginName'=> '75af1daa73e96bf48beaf632088af7d65d4b26d39ed4c6be2705ca2be7fbe31a87bee07c30e6d95a6800f7e25d837ce6766a45a345b9ca6e36359070577e2e5c8146f532d110a9f7a15838b5e8d6c32e51b72bc0f65ab8f8187d216e28381a92cca716bbbf25a818cf4dd95b4c0ef46bf1318599a6456c666002cefee094b17e',
            'encryptedPassWord'=> '58186cc9c573d9061b9d505b2745be8b98351f05a6aac6c62845a41cd044889e2f3f5f595359b98a29f709abe1092dd58341a3d7260545d1eb5aafc0efad5f73aeedbeaa453923a53a8a7d57a42da8195de1c076e314dd4099336007fb418a9d8fc08034c6591720018d508b924626cdcce7f8d82dedfe0f67ab65e6eb3e053a',
            'priority'=> 93,
            'authMethod'=> 'login',
            'returnURL'=> 'http://soffice.11st.co.kr?ts=1596181197873',
            'loginName'=> 'ysjlabs',
            'passWord' => 'yakeun87!@',
        ];
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/logincheck.tmall', $data);
 
        $data = [
            'method' => 'getOrderLogisticsList',
            'listType' => 'orderingLogistics',
            'start'=> 0,
            'limit'=> 30,
            'shDateType'=> '01',
            'shDateFrom'=> $start_date,
            'shDateTo'=> $end_date,
            'shBuyerType'=> '',
            'shBuyerText'=>'',
            'shProductStat'=> 'ALL',
            'shDelayReport' => '',
            'shPurchaseConfirm' => '',
            'shGblDlv'=> 'N',
            'prdNo' => '',
            'shStckNo' => '',
            'shOrderType' => 'on',
            'shToday' => '',
            'shDelay'=> '',
            'addrSeq'=> '',
            'isAbrdSellerYn' => '',
            'abrdOrdPrdStat' => '',
            'isItalyAgencyYn' => '',
            'shErrYN' => '',
            'gblRcvrNm' => '%EA%B8%80%EB%A1%9C%EB%B2%8C%ED%86%B5%ED%95%A9%EB%B0%B0%EC%86%A1%EC%A7%80',
            'gblRcvrMailNo'=> '17382',
            'gblRcvrBaseAddr'=> '%EA%B2%BD%EA%B8%B0%EB%8F%84%20%EC%9D%B4%EC%B2%9C%EC%8B%9C%20%EB%A7%88%EC%9E%A5%EB%A9%B4%20%EB%A7%88%EB%8F%84%EB%A1%9C%20177%20',
            'gblRcvrDtlsAddr'=>' %EA%B2%BD%EA%B8%B0%EB%8F%84%20%EC%9D%B4%EC%B2%9C%EC%8B%9C%20%EB%A7%88%EC%9E%A5%EB%A9%B4%20%EB%A7%88%EB%8F%84%EB%A1%9C%20177%20%204%EC%B8%B5%20%EC%A0%84%EC%84%B8%EA%B3%84%5BEMS%5D%EB%B0%B0%EC%86%A1%20%EB%8B%B4%EB%8B%B9%EC%9E%90',
            'gblRcvrTlphn'=> '1599-5115',
            'gblRcvrPrtblNo'=> '000-000-0000',
            'shOrdLang'=> '',
            'shDlvClfCd'=> '',
            'shVisitDlvYn'=> 'N',
            'shUsimDlvYn'=> 'N'
        ];

        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/escrow/OrderingLogisticsAction.tmall?method=getOrderLogisticsList&listType=orderingLogistics&start=0&limit=30&shDateType=01&shDateFrom='. $start_date . '&shDateTo=' . $end_date . '&shBuyerType=&shBuyerText=&shProductStat=ALL&shDelayReport=&shPurchaseConfirm=&shGblDlv=N&prdNo=&shStckNo=&shOrderType=on&shToday=&shDelay=&addrSeq=&isAbrdSellerYn=&abrdOrdPrdStat=&isItalyAgencyYn=&shErrYN=&gblRcvrNm=%25EA%25B8%2580%25EB%25A1%259C%25EB%25B2%258C%25ED%2586%25B5%25ED%2595%25A9%25EB%25B0%25B0%25EC%2586%25A1%25EC%25A7%2580&gblRcvrMailNo=17382&gblRcvrBaseAddr=%25EA%25B2%25BD%25EA%25B8%25B0%25EB%258F%2584%2520%25EC%259D%25B4%25EC%25B2%259C%25EC%258B%259C%2520%25EB%25A7%2588%25EC%259E%25A5%25EB%25A9%25B4%2520%25EB%25A7%2588%25EB%258F%2584%25EB%25A1%259C%2520177%2520&gblRcvrDtlsAddr=%25EA%25B2%25BD%25EA%25B8%25B0%25EB%258F%2584%2520%25EC%259D%25B4%25EC%25B2%259C%25EC%258B%259C%2520%25EB%25A7%2588%25EC%259E%25A5%25EB%25A9%25B4%2520%25EB%25A7%2588%25EB%258F%2584%25EB%25A1%259C%2520177%2520%25204%25EC%25B8%25B5%2520%25EC%25A0%2584%25EC%2584%25B8%25EA%25B3%2584%255BEMS%255D%25EB%25B0%25B0%25EC%2586%25A1%2520%25EB%258B%25B4%25EB%258B%25B9%25EC%259E%2590&gblRcvrTlphn=1599-5115&gblRcvrPrtblNo=000-000-0000&shOrdLang=&shDlvClfCd=&shVisitDlvYn=N&shUsimDlvYn=N', $data);
        $dataOrder = json_decode($client->getResponse()->getContent(),true);
        // echo "<pre>";
        // print_r($dataOrder);
        // die;
        if ($dataOrder['orderingLogistics']) {
            foreach ($dataOrder['orderingLogistics'] as $items) {
                //$sellerProductId = microtime(true) * 10000;
                if (isset($items['INVC_NO'])) {
                    $ticket = [
                        'ticketNumber' => $items['INVC_NO'],
                        'purchasedAt' => $items['ORD_STL_END_DT'], // Ngày đặt hàng
                        'price' => str_replace(',' , '', $items['SEL_PRC']), // giá bán
                        'useAmount' => $items['ORD_QTY'],// $items['ORDER_AMT'], // Số lượng đơn đặt hàng
                        'totalAmount' => $items['ORD_QTY'],
                        'dealId' => $items['PRD_NO']
                    ];
                    $result = $this->_model->loadRecords('ticket', ['ticketNumber' => $items['INVC_NO']]);
                    if ($result) {
                        $this->_model->updateRecord('ticket', $ticket, ['ticketNumber' => $items['INVC_NO']]);
                    }else {
                        $this->_model->insertRecord('ticket', $ticket);
                    }                    
                    $dealName=str_replace('<DIV style="TEXT-ALIGN: center; PADDING-BOTTOM: 2px; MARGIN-TOP: 0px; TEXT-OVERFLOW: ellipsis; OVERFLOW: hidden"><FONT style="CURSOR: pointer; TEXT-DECORATION: underline">', '', $items['PRD_NM_VIEW']);
                    $dealName=str_replace('</FONT></DIV>', '', $dealName);
                    $ticketPurchasers = [
                        'orderNumber' => $items['ORD_NO'], //
                        'ticketNumber' => $items['INVC_NO'],
                        'purchaseDateTime' => $items['ORD_STL_END_DT'], // Ngày đặt hàng
                        'price' => str_replace(',' , '', $items['SEL_PRC']), // giá bán
                        'fee' => str_replace(',' , '', $items['SEL_FEE_RT']), // Phí dịch vụ
                        'dealId' => $items['PRD_NO'], //
                        'dealName' => $dealName,
                        'optionId' => "",
                        'optionName' => "",
                        'userName' => $items['MEM_ID'], // Người mua (ID)
                        'phoneNumber' => $items['RCVR_PRTBL_NO'], //   Thông tin liên lạc 2
                        'channel_name' =>  "11ST"
                    ];
                    
                    $result = $this->_model->loadRecords('ticketPurchasers', ['ticketNumber' => $items['INVC_NO']]);
                    if ($result) {
                        $this->_model->updateRecord('ticketPurchasers', $ticketPurchasers, ['ticketNumber' => $items['INVC_NO']]);
                    }else {
                        $this->_model->insertRecord('ticketPurchasers', $ticketPurchasers);
                    }
                    
                    
                }
            }
        }
        
    }

    // Đăng ký sản phẩm
    public function applyProductInfoAction() {
//         echo '<pre>';
//         print_r($_POST);
        
//         print_r($_FILES);
        
//         echo json_encode($_POST)."<br>";
        
//         echo json_encode($_FILES)."<br>";

//         die();
        $client = new Client( HttpClient::create(['timeout' => 60]));
        
        // đăng nhập
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/logincheck.tmall');
        $form = $crawler->selectButton("로그인")->form();
        $crawler = $client->submit($form, array(
            'encryptedLoginName'=> '9c7db06852fbbf8698ad4dc5998697c2a215300ae99bfa2cfefc633e219783d15774d2ce55ef41366172d92a4c7404164295673f726074bcc9e6ea708999d7b2f7eb26a8d8c239732b716a0f781112faa1d5540c4bab6474972bebd1f2daa69c244f4450792f6d9ea3171544fc4e61692a4d2652980b440e4013fb4c1dfac0cd',
            'encryptedPassWord'=> '9f914d7c95360c590c6d22ddbde670a917316b0e37d766d43babfcc32208ce488f8a69eab512fa9bbd63733301a52d0acadbbe81c904c5d341d2235581ff059de14f83ff0cec1fc699a86d558fc9ad993469147390733f70e4c85197bb38dc8831dcfc23a95137d1ddab1486d346ee268bf3835fc94faf423aa4c1738dc61799',
            'priority'=> 96,
            'authMethod'=> 'login',
            'returnURL'=> 'http://soffice.11st.co.kr?ts=1601958706442',
            'loginName'=> 'ysjlabs',
            'passWord' => 'yakeun87!@',));
            
//         // image
//         $data =[
//             'categoryNo' => '1129331',
//             'imagePath' => 'http://cdn.011st.com/11dims/resize/600x600/quality/75/11src/pd/20/7/7/0/0/9/6/MGSEh/2941770096_B.jpg'
//         ];

//         $crawler = $client->request('GET', 'https://apis.11st.co.kr/product/hulk/v2/productCleansing/image?' . http_build_query($data));
//         $content =$client->getResponse()->getContent();
//         echo '<pre>';
//         print_r($content);
//         echo '</pre>';
        
        //$content =$client->getResponse()->getContent();
        
        $client->xmlHttpRequest('GET', 'https://soffice.11st.co.kr/product/UnitProductRegAction.tmall?method=regForm&urlType=SO');
        
        // https://apis.11st.co.kr/product/hulk/v2/productCleansing/prdNm               kiểm tra sạch sản phẩm
        $data = [
            'prdNm'=> 'aaaaa',
            'mCtgr'=> '1017871'
        ];
        
        $crawler = $client->xmlHttpRequest('POST', 'https://apis.11st.co.kr/product/hulk/v2/productCleansing/prdNm', $data);
        $content =$client->getResponse()->getContent();
        
        //print_r($content);
        
        //https://apis.11st.co.kr/product/hulk/v2/productCleansing/advrtStmt       kiểm tra sạch vản bản
        $data = [
        'prdNm' => 'aaaaa',
        'advrtStmt' => 'bbbb'
                ];
        
        $crawler = $client->request('POST', 'https://apis.11st.co.kr/product/hulk/v2/productCleansing/advrtStmt', $data);
        $content =$client->getResponse()->getContent();
        //echo '<pre>';
        //print_r($content);
   
        
        $data= [
            'dispCtgrNo' => '1129331',
            'content' => 'aaaaa'
        ];
        $client->xmlHttpRequest('POST', 'https://soffice.11st.co.kr/tns/tnsKeywdPrdFilterAjax.tmall?method=getKeywdPrdFilterCnt',$data);
        $content =json_decode($client->getResponse()->getContent(),true);
        //echo '<pre>';
       // print_r($content);
        
        
        $data= [
            'dispCtgrNo' => '1129331',
            'content' => ''
        ];
        $client->xmlHttpRequest('POST', 'https://soffice.11st.co.kr/tns/tnsKeywdPrdFilterAjax.tmall?method=getKeywdPrdFilterCnt',$data);
        $content =json_decode($client->getResponse()->getContent(),true);
        //echo '<pre>';
        //print_r($content);
        
        // đăng ký sản phẩm
        $data = [
            'method' => 'applyProductInfo',
            'stdPrdYn' => 'Y',
            'prdNo' => '',
            'userNo' => '61539422',
            'selMnbdNo' => '61539422',
            'memTyp' => '02',
            'prdTypCd' => '10',
            'orgPrdTypCd' => '',
            'dispCtgrNo' => '1129331',
            'originDispCtgrNo' => '',
            'sellerAuth' => 'Y',
            'dispCtgrStatCd' => '03',
            'dispCtgrUseYn' => 'Y',
            'rootCtgrNo' => '117025',
            'mnfcYN' => '',
            'dispCtgrPrdTypCd' => '09',
            'serviceCouponYN' => 'N',
            'mobileYn' => 'N',
            'HtmlDetail' => 'dasdas',
            'HtmlDetailJson' => '',
            'intfreeApplyYn' => 'Y',
            'selMthdCd' => '01',
            'setTypCd' => '01',
            'selStatCd' => '',
            'autoPrcsedStartDy' => '',
            'preSelPrdClfCd' => '',
            'preSelMthdCd' => '01',
            'preCategory2' => '1017871',
            'preCategory3' => '1017872',
            'originSelPrc' => '',
            'mobile1WonApprvAsk' => '',
            'selLimitQty' => '0',
            'selMinLimitQty' => '0',
            'buyUntQty' => '0',
            'checkAbrdBrandYn' => 'N',
            'isAbrdInteg' => 'false',
            'checkYes24' => 'false',
            'checkSoYes24' => 'false',
            'checkKyoBo' => 'false',
            'sndPlnTrm' => '4',
            'suplDtyfrPrdClfCd' => '01',
            'mrgnPolicyCd' => '',
            'shopNo' => '',
            'cyberMoney' => '0',
            'hasPoint' => '11665',
            'dispAmount' => '0',
            'dispRealAmount' => '0',
            'payAmount' => '0',
            'payCommonCoupon' => 'N',
            'payCouponAmount' => '0',
            'preDispAmount' => '0',
            'saleStartDate' => '20201008',
            'saleEndDate' => '20210204',
            'preStartDate' => '2020/10/08',
            'obCouponCobuyRate' => '0',
            'obCouponDispItemRate' => '0',
            'sellerItemEventYn' => 'N',
            'sellerCash' => '0',
            'mobileSellerYN' => 'N',
            'allkeyword' => '',
            'lowPrcCompExYn' => '',
            'ctgrPntPreExYn' => '',
            'productSCashChargUrl' => 'https://soffice.11st.co.kr/loyalty/CyberMoneyChargeAction.tmall?method=CyberMoneyCharge',
            'productSPointChargUrl' => 'https://soffice.11st.co.kr/loyalty/AuthSellerPointCondition.tmall?method=goSellerPointChargePage&chargeDomain=soSellerPrdInfo',
            'prdCopyYn' => 'N',
            'prdCopyYnOpt' => 'N',
            'reRegPrdNo' => '',
            'reRegYn' => '',
            'reNewYn' => 'N',
            'displayYn' => '',
            'popYn' => '',
            'formType' => 'N',
            'createCd' => '0200',
            'regTypeCd' => '',
            'styleCtgrNo' => '195046',
            'maxLimitQty' => '0',
            '_help_msg_' => '',
            'applyInfo' => ['{prdNo:0,dispItemList:[],dispAutoItemList:[],listAdCupnList:[]}'],
            'frSellerYN' => 'N',
            'frPrdNo' => '',
            'pdEventCnt' => '0',
            'evtConfirmCnt' => '0',
            'cHkPrdStatCd' => '01',
            'svcAreaCd' => '',
            'townPrdYn' => 'N',
            'selNo' => '61539422',
            'simpleYn' => 'N',
            'isTownExcelUser' => 'N',
            'townSellerCertType' => '',
            'dispCtgrGblDlvYn' => 'N',
            'sellerGblDlvYn' => 'Y',
            'infoTypeCtgrNo' => '891011',
            'prdInfoTmpltNo' => '0',
            'isCtgrAttr' => 'N',
            'adultCtgr' => 'N',
            'adltCrtfYn' => 'Y',
            'rentalCategoryYn' => 'N',
            'oriPrdSelQty' => '',
            'offerDispLmtYn' => 'N',
            'cellClickRowIdx' => '',
            'bookClfCd' => '',
            'isAbrdSubInteg' => 'false',
            'seriesPrdYn' => 'false',
            'minusCtlgNo' => '',
            'prdTypCdChangeYn' => '',
            'eventPrdYn' => '',
            'employeeNo' => '',
            'ktb_agent' => '',
            'rsvSchdlYN' => 'N',
            'prdRiousQty' => '0',
            'svcCnAreaRgnAddrCd' => '',
            'svcCnAreaRgnClfCd' => '',
            'svcCnAreaSidoNm' => '',
            'svcCnAreaSiGunGuNm' => '',
            'svcCnAreaUeupMyonNm' => '',
            'svcCnAreaUeupMyonCd' => '',
            'bindProduct' => 'false',
            'addtInfoList' => [],
            'browserValue' => 'Chrome 85',
            'tourDateAttrNos' => '',
            'recomCtgrNos' => '',
            'validated' => 'validated',
            'isTWDSeller' => 'false',
            'isTWDCategory' => 'false',
            'currentYY' => '2020',
            'noUseOptionYn' => 'N',
            'is11PayView' => 'true',
            'otherPrdRegYn' => 'N',
            'isUpdate' => 'false',
            'canChangeStdPrdNm' => 'true',
            'preModelNo' => '',
            'ctlgModelNo' => '',
            'modelExistYn' => 'N',
            'factory' => '',
            'brandNm' => '',
            'preModelNm' => '',
            'ctlgNo' => '',
            'ctlgSvcClf' => '',
            'ctlgUseYn' => '',
            'martPrdYn' => '',
            'newMartPrdYn' => 'N',
            'brandNmTmp' => '',
            'brandCdTmp' => '',
            'cmAttrYn' => '',
            'chgModel' => '',
            'brand' => '',
            'modelNm' => '',
            'prdNm' => 'aaaaa',
            'prdclnsg_api_req_prd_nm' => 'aaaaa',
            'advrtStmt' => 'aaaaa',
            'prdclnsg_api_req_advrt_stmt' => 'aaaaa',
            'sellerPrdNmEn' => '7JiB7Ja0LOyIq+yekOunjCDsnoXroKUg6rCA64ql7ZWp64uI64ukLg==',
            'sellerPrdNmCn' => '7KSR6rWt7Ja0LOyYgeyWtCzsiKvsnpDrp4wg7J6F66ClIOqwgOuKpe2VqeuLiOuLpC4=',
            'sellerPrdNmEnPre' => '',
            'sellerPrdNmCnPre' => '',
            'engDispYn' => 'Y',
            'prdNmEng' => '',
            'recentCtgr' => '1129331:117025>1017871>1017872>1129331',
            'selPrdTypCd' => '10',
            'chkSelMthdCd' => '01',
            'prdStatCd' => '01',
            'useMon' => '',
            'useMonTxt' => '',
            'paidSelPrc' => '',
            'usedMnfcDy' => '',
            'usedEftvDy' => '',
            'specialNoteComboBox' => '직접입력',
            'exteriorSpecialNote' => '',
            'selTermUseYn' => 'Y',
            'selPrdClfCd' => '120:108',
            'aplBgnDy' => '2020/10/08',
            'aplBgnHh' => '00',
            'aplBgnMi' => '00',
            'aplBgnSs' => '00',
            'aplEndDy' => '2021/02/04',
            'aplEndHh' => '23',
            'aplEndMi' => '59',
            'aplEndSs' => '59',
            'autoPrcsClfCd' => '',
            'fpSelTermUseYn' => 'Y',
            'selPrdClfFpCd' => '-1:-1',
            'useLimitDay' => '',
            'usePrdClfCd' => '0:500',
            'useBgnDy' => '',
            'useEndDy' => '',
            'wrhsPlnDy' => '',
            'prdRiousQtyYN' => 'N',
            'dlvProcCanDD' => '1',
            'clickPrdNumber' => '01',
            'imageKindChk' => '01',
            'uploadHost' => 'http://image.11st.co.kr',
            'uploadPath' => '/data1/upload/imgprd',
            'isFreeImageSize' => 'N',
            'productImageCapaCheckSize' => '3145728',
            'productImageCapaSize' => '3MB',
            'prdImage01_FileNm' => 'http://stylehanquoc.com/Screenshot_10.png',
            'prdImageNo01' => '',
            'prdImageEditorUrl01' => '',
            'prdImageEditorRealName01' => '',
            'prdImageUrl01' => '',
            'prdImageUrl01Host' => '',
            'prdImageChk01' => 'Y',
            'prdImagePath01' => '/product/tmp/reg/20201008/61539422/61539422_20201008134817741_PXBve.png',
            'prdImage02_FileNm' => '',
            'prdImageNo02' => '',
            'prdImageEditorUrl02' => '',
            'prdImageEditorRealName02' => '',
            'prdImageUrl02' => '',
            'prdImageUrl02Host' => '',
            'prdImageChk02' => 'N',
            'prdImagePath02' => '',
            'prdImage03_FileNm' => '',
            'prdImageNo03' => '',
            'prdImageEditorUrl03' => '',
            'prdImageEditorRealName03' => '',
            'prdImageUrl03' => '',
            'prdImageUrl03Host' => '',
            'prdImageChk03' => 'N',
            'prdImagePath03' => '',
            'prdImage04_FileNm' => '',
            'prdImageNo04' => '',
            'prdImageEditorUrl04' => '',
            'prdImageEditorRealName04' => '',
            'prdImageUrl04' => '',
            'prdImageUrl04Host' => '',
            'prdImageChk04' => 'N',
            'prdImagePath04' => '',
            'prdImage05_FileNm' => '',
            'prdImageNo05' => '',
            'prdImageEditorUrl05' => '',
            'prdImageEditorRealName05' => '',
            'prdImageUrl05' => '',
            'prdImageUrl05Host' => '',
            'prdImageChk05' => 'N',
            'prdImagePath05' => '',
            'dealImageSize' => '3145728',
            'dealImageSizeView' => '3MB',
            'dealImageWidthLimit' => '720',
            'dealImageHeightLimit' => '360',
            'prdImageUrl09' => '',
            'prdImage09_FileNm' => '',
            'prdImage010_FileNm' => '',
            'prdImageNo010' => '',
            'prdImageEditorUrl010' => '',
            'prdImageEditorRealName010' => '',
            'prdImageUrl010' => '',
            'prdImageUrl010Host' => '',
            'prdImageChk010' => 'N',
            'minorSelCnYn' => 'Y',
            'rmaterialInfo' => '',
            'orgnTypCd' => '01',
            'orgnNm' => '',
            'beefTraceNo' => '',
            'beefTraceDtl' => '',
            'chkSuplDtyfrPrdClfCd' => '01',
            'yearEndTaxYn' => 'N',
            'certInfoCnt' => '0',
            'crtfGrpObjClfCd01' => '01',
            'crtfGrpExptTypCd01' => '',
            'crtfGrpObjClfCd02' => '01',
            'crtfGrpObjClfCd03' => '01',
            'crtfGrpObjClfCd04' => '05',
            'medNum1' => '',
            'medNum2' => '',
            'medNum3' => '',
            'theaterMnfcDy' => '',
            'theaterEftvDy' => '',
            'seatTyp' => 'Y',
            'theaterNm' => '',
            'theaterAreaInfo' => '',
            'selPrc' => '10,000',
            'calcSelFeeAmt' => '800',
            'addtInfo01' => '0',
            'addtInfo02' => '0',
            'addtInfo03' => '0',
            'colTitle' => '',
            'colValue0' => '',
            'colValue1' => '',
            'colValue2' => '',
            'colCount' => '',
            'colOptPrice' => '',
            'colPuchPrc' => '',
            'colMrgnRt' => '',
            'colMrgnAmt' => '',
            'colAprvStatCd' => '',
            'prdStckStatCd' => '',
            'colBarCode' => '',
            'colOptWght' => '',
            'colCstmAplPrc' => '',
            'optClfCd' => '01',
            'optChangeYn' => 'Y',
            'txtColCnt' => '',
            'optTypCd' => '',
            'colSellerStockCd' => '',
            'twdCatalogMapCd' => '',
            'ptnrPrdSellerYN' => 'N',
            'prdExposeClfCd' => '00',
            'addProductMaxCnt' => '0',
            'addProductMaxIdx' => '0',
            'dispPrrtRnk' => '0',
            'prdSelQty' => '100',
            'rsvSchdlClfCd' => '01',
            'rsvSchdlModifyYN' => 'N',
            'maktPrc' => '',
            'maktRt' => '',
            'mpContractTypCd' => '01',
            'hdRepFeeYN' => '',
            'moblieFeeGrpNm' => '선택하세요',
            'moblieFeeNm' => '선택하세요',
            'mobileMthFee' => '',
            'contractTermCd' => '',
            'mobilePhoneInstallmentArr' => '',
            'mpFeeNo' => '',
            'mrgnRt' => '',
            'mrgnAmt' => '',
            'puchRt' => '',
            'puchPrc' => '',
            'cstmAplPrc' => '',
            'prdCautions' => '',
            'notDealPage' => 'true',
            'chkPrdDescWrite' => 'Y',
            'designTemplate' => 'Y',
            'templateType' => 'basic',
            'layoutType' => '1',
            'descTypeCode' => '',
            'callbygridYNStr' => 'N',
            'smartOptionYN' => '',
            'introHtmlDetail' => '',
            'outroHtmlDetail' => '',
            'prdDtlDescStr' => '',
            'reviewDispYn' => 'Y',
            'prdImage08_FileNm' => '',
            'prdImageNo08' => '',
            'prdImageEditorUrl08' => '',
            'prdImageEditorRealName08' => '',
            'prdImageUrl08' => '',
            'prdImageUrl08Host' => '',
            'prdImageChk08' => 'N',
            'movieObjNo' => '0',
            'svcCanRgnClfCd' => '01',
            'previousSvcCanRgnClfCd' => '',

            'prdDetailOutLink' => '',
            'prdSvcBgnDy' => '',
            'prdSvcEndDy' => '',
            'ticketSvcBgnDy' => '',
            'ticketSvcBgnTime' => '',
            'ticketSvcEndDy' => '',
            'ticketSvcEndTime' => '',
            'agencyBsnsNo' => '',
            'agencyNm' => '',
            'agencyBsnsSt' => '',
            'agencyItm' => '',
            'rptvNm' => '',
            'rptvTlphnNoNo' => '',
            'rptvEmailAddr' => '',
            'enpPlcAddr' => '',
            'preVwCd' => '',
            'freeGiftTgNo1' => '',
            'freeGiftTgNo2' => '',
            'infoAddText' => '',
            'selMnbdNckNmSeq' => '933027',
            'releaseYY' => '2020',
            'releaseMM' => '12',
            'modelCd' => '',
            'sellerPrdCd' => '',
            'selMinLimitTypCd' => '00',
            'selLimitTypCd' => '00',
            'bcktExYn' => 'Y',
            'orderCmltOutLink' => '',
            'mudvdLabel' => '',
            'mnfcDy' => '',
            'eftvDy' => '',
            'mainTitle' => '',
            'transInfo' => '',
            'picInfo' => '',
            'isbn13Cd' => '',
            'isbn10Cd' => '',
            'bookAddCd' => '',
            'prcCmpExpYn' => 'Y',
            'giftNm' => '',
            'giftAplBgnDt_old' => '2020/10/08',
            'giftAplEndDt_old' => '2020/10/08',
            'giftAplBgnDt' => '2020/10/08',
            'giftAplEndDt' => '2020/10/08',
            'giftImageUrl_UploadYn' => 'N',
            'giftImageUrl_FileNm' => '',
            'giftImageUrl_Path' => '',
            'giftInfo' => '',
            'gftPackTypCd' => '01',
            'coCardBnft' => '',
            'instCstDesc' => '',
            'frgftDesc' => '',
            'etcInfo' => '',
            'rcptIsuCnYn' => 'Y',
            'todayDlvCnYn' => 'N',
            'appmtDyDlvCnYn' => 'N',
            'bndlDlvCnYn' => 'Y',
            'bsnDealClf' => '01',
            'dlvClf' => '02',
            'outMemNo' => '61539422',
            'inMemNo' => '61539422',
            'abrdInCd' => '',
            'kglFreePickupYN' => 'N',
            'tmplYn' => 'N',
            'isAbrdIntegId' => 'false',
            'isAbrdSubIntegId' => 'false',
            'itgAddrSeq' => '0',
            'globalOutMemNo' => '0',
            'globalInMemNo' => '0',
            'incFormType' => 'N',
            'wholeYn' => 'N',
            'frCtrCd' => '',
            'bakPrdWght' => '',
            'bakGblHsCode' => '',
            'gblDlvYnValue' => 'N',
            'hasPermToSecureInstall' => 'false',
            'selTempleteInput' => '790596',
            'gblDlvYn' => '',
            'gblHsCode' => '',
            'dlvCnAreaCd' => '03',
            'dlvWyCd' => '04',
            'dlvEtprsCd' => '',
            'dlvSendCloseTmpltNo' => '694389',
            'sendClfCd' => '02',
            'sendCmplTerm' => '1',
            'wkdayPayCmplHm' => '',
            'satPayCmplHm' => '',
            'mbAddrLocation02' => '01',
            'outAddrSeq' => '5',
            'mbAddrLocation03' => '01',
            'inAddrSeq' => '6',
            'mbAddrLocation07' => '',
            'visitExchAddrSeq' => '',
            'mbAddrLocation05' => '',
            'globalOutAddrSeq' => '',
            'globalOutAddrNM' => '',
            'mbAddrLocation06' => '',
            'globalInAddrSeq' => '',
            'globalInAddrNM' => '',
            'chkDlvClf' => '02',
            'prdWght' => '',
            'exptDlvCst' => '',
            'volumeWidth' => '',
            'volumeColumn' => '',
            'volumeHeight' => '',
            'ntNo' => '',
            'sellerBasiDlvCstTxt' => '',
            'dlvCstPayTypCd' => '03',
            'addrBasiDlvCstTxt' => '무료@1원 미만 구매/무료@1원 이상 구매',
            'dlvCstInstBasiCd' => '03',
            'dlvCst5' => '2,500',
            'dlvBasiAmt' => '30,000',
            'dlvCnt2' => '999999999',
            'mbAddrLocation04' => '',
            'visitAddrSeq' => '',
            'abrdCnDlvCst' => '',
            'rtngdDlvCst' => '2,500',
            'rtngdDlvCd' => '02',
            'exchDlvCst' => '5,000',
            'ASDetail' => '1544-2602',
            'rtngExchDetail' => '1544-2602',
            'selInfoTempleteNm' => '템플릿 이름을 입력해 주세요.',
            'addQueryCont' => '',
            'addQueryHintCont' => '',
            'refundTargetFlag' => 'false',
            'dispItemNo' => '182',
            'selDisplayItemTerm' => '0',
            'svcBgnDy' => '2020-10-08',
            'selAutoDisplayItemTerm' => '0',
            'svcEndDy' => '2020-11-07',
            'payPoint' => '0',
            'payCash' => '0',
            'payCyberMoney' => '0',
            'payCouponAmount09' => '0',
            'dscCouponTerm09' => '0',
            
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200044',
//             'prdAttrCd' => '11835',
//             'prdAttrType' => 'null',
//             'prdAttrChkNo' => '200044',
            '200044' => '상품상세설명 참조',
            'chkattrValueNm0' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200054',
//             'prdAttrCd' => '23756520',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200054',
            '200054' => '상품상세설명 참조',
            'chkattrValueNm1' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200121',
//             'prdAttrCd' => '23759095',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200121',
            '200121' => '상품상세설명 참조',
            'chkattrValueNm2' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200167',
//             'prdAttrCd' => '23759308',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200167',
            '200167' => '상품상세설명 참조',
            'chkattrValueNm3' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200177',
//             'prdAttrCd' => '23759468',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200177',
            '200177' => '',
            'chkattrValueNm4' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200144',
//             'prdAttrCd' => '11905',
//             'prdAttrType' => '01',
//             'prdAttrChkNo' => '200144',
            '200144' => '',
            'chkattrValueNm5' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200229',
//             'prdAttrCd' => '23760034',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200229',
            '200229' => '상품상세설명 참조',
            'chkattrValueNm6' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200282',
//             'prdAttrCd' => '23760437',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200282',
            '200282' => '상품상세설명 참조',
            'chkattrValueNm7' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '200259',
//             'prdAttrCd' => '23760386',
//             'prdAttrType' => '02',
//             'prdAttrChkNo' => '200259',
            '200259' => '상품상세설명 참조',
            'chkattrValueNm8' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '269115',
//             'prdAttrCd' => '11811',
//             'prdAttrType' => '01',
//             'prdAttrChkNo' => '269115',
            '269115' => '상품상세설명 참조',
            'chkattrValueNm9' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '269117',
//             'prdAttrCd' => '11908',
//             'prdAttrType' => '01',
//             'prdAttrChkNo' => '269117',
            '269117' => '상품상세설명 참조',
            'chkattrValueNm10' => '상품상세설명 참조',
            
//             'prdAttrNm' => '(unable to decode value)',
//             'prdAttrNo' => '269118',
//             'prdAttrCd' => '11942',
//             'prdAttrType' => 'null',
//             'prdAttrChkNo' => '269118',
            '269118' => '상품상세설명 참조',
            'chkattrValueNm11' => '상품상세설명 참조',
       ];
       $post= [
           'prdImage01' => [
               'name' => 'Screenshot_10.png',
               'type' => 'image/png',
               'tmp_name' => "http://stylehanquoc.com/Screenshot_10.png",
               'error' => '0',
               'size' => '40775'
           ],
           'prdImage02' => [],
           'prdImage03' => [],
           'prdImage04' => [],
           'prdImage05' => [],
           'prdImage08' => [],
           'prdImage09' => [],
           'prdImage010' => [],
           'giftImageUrl_File' => [],
       ];
        
       $crawler=$client->xmlHttpRequest('POST', 'https://soffice.11st.co.kr/product/UnitProductRegAction.tmall',$data,$post,['Content-Type' => 'multipart/form-data' ]);
        echo '<pre>';
        print_r($crawler->html());
        
      

    }
        
    public function getProductAction($start_date = null, $end_date = null) {
        if ($start_date == null && $end_date == null) {
            $start_date = (date("Y") - 1)  . date("md");
            $end_date = date("Ymd");
        }
        
        $client = new Client(HttpClient::create(['timeout' => 60]));
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/login.tmall?returnURL=http://soffice.11st.co.kr');
        
        $form = $crawler->selectButton("로그인")->form();
        $crawler = $client->submit($form, array(
            'encryptedLoginName' => '5c9930fcf66bf5d4fe8803db86387a427b56b013452be0c765b9011d179c105f38f590019b05ee1503dcf5ed29dcda81b9b641603b34cf7a927c9f3e5fc8202b6db9e4d7b9963d75994f8623a46d5971f80b5d186cd982a87ad7bb134834bfa732939c06e523e1ca81d161e6d628c7da0adc290832d191d5c66f9aa80b9a7097',
            'encryptedPassWord' => '5aaae845004b40e1133f7c7428500e11836b648aebf3dbbf22b6a570649c3b0db7d4bc47c5a28b7a7ba3f1fac7e5cc4e9b1a0efce66627db241a15a1b9e1f7662432509ac9493d52bfdbc055fa8ab7730a89749aa75bc8fb6f76fff5cefdc95c82fc6dc69a8fc187e238b1b9cdbfcd226e730c19e99d708d92e3960517c9bd79',
            'loginName' => 'ysjlabs',
            'passWord' => 'yakeun87!@'));
        $data = [
            'encryptedLoginName'=> '75af1daa73e96bf48beaf632088af7d65d4b26d39ed4c6be2705ca2be7fbe31a87bee07c30e6d95a6800f7e25d837ce6766a45a345b9ca6e36359070577e2e5c8146f532d110a9f7a15838b5e8d6c32e51b72bc0f65ab8f8187d216e28381a92cca716bbbf25a818cf4dd95b4c0ef46bf1318599a6456c666002cefee094b17e',
            'encryptedPassWord'=> '58186cc9c573d9061b9d505b2745be8b98351f05a6aac6c62845a41cd044889e2f3f5f595359b98a29f709abe1092dd58341a3d7260545d1eb5aafc0efad5f73aeedbeaa453923a53a8a7d57a42da8195de1c076e314dd4099336007fb418a9d8fc08034c6591720018d508b924626cdcce7f8d82dedfe0f67ab65e6eb3e053a',
            'priority'=> 93,
            'authMethod'=> 'login',
            'returnURL'=> 'http://soffice.11st.co.kr?ts=1596181197873',
            'loginName'=> 'ysjlabs',
            'passWord' => 'yakeun87!@',
        ];
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/logincheck.tmall', $data);
        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/SellProductAjaxAction.tmall?method=getSellProductListJSON&srchTyp=prdNew&start=0&limit=30&prdNo=&prdNm=&searchType=PRDNO&dateType=CREATE&category1=&category2=&category3=&category4=&chkSelStatCds=&selMthdCd=&createDt=&createDtTo=&stckQty=&remainSelDt=&premiumAplDt=&dlvCstInstBasiCd=&dlvCstPayTypCd=&premiumPlusAplDt=&data=&searchListingItemClsf=&drivingListingItemClsf=&shopNo=&prdTypCd=&omPrdYn=&svcAreaCd=&stdPrdYn=');
        $content = html_entity_decode($client->getResponse()->getContent());
        $content= substr($content,1);
        $content= substr($content,0,-1);
        $dataProduct = json_decode($content,true);
        
        for ($i = 0; $i < $dataProduct['TOTAL_COUNT']; $i++) {
            $goodsId= $dataProduct['DATA_LIST'][$i]['prdNo'];
            $result = $this->_model->loadRecords('salechannel', ['travelProductId' =>$goodsId]);
            if ($result) {
                $this->_model->updateRecord('salechannel', ['channelId' => 6, 'productId' => $goodsId, 'vendorItemPackageId' =>$goodsId] , ['travelProductId' => $goodsId]);
            }else {
                $this->_model->insertRecord('salechannel', ['travelProductId' => $goodsId , 'channelId' => 6, 'productId' => $goodsId, 'vendorItemPackageId' => $goodsId]);
            }
        }
    }
    public function questionAction($start_date = null, $end_date = null) {

        if ($start_date == null && $end_date == null) {
            $start_date = (date("Y") - 1) . '/' .  date("m/d");
            $end_date = date("Y/m/d"); 
        }
        //echo str_replace("/","-", $start_date).' 00:00:00';
        $this->_model->updateRecord('question', ['isDelete' => 1], ['where' => 'question_created > "'.str_replace("/","-", $start_date).' 00:00:00" AND channel_name="11ST"']);  
        
        $client = new Client(HttpClient::create(['timeout' => 60]));
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/login.tmall?returnURL=http://soffice.11st.co.kr');
        $form = $crawler->selectButton("로그인")->form();
        $crawler = $client->submit($form, array(
            'encryptedLoginName' => '5c9930fcf66bf5d4fe8803db86387a427b56b013452be0c765b9011d179c105f38f590019b05ee1503dcf5ed29dcda81b9b641603b34cf7a927c9f3e5fc8202b6db9e4d7b9963d75994f8623a46d5971f80b5d186cd982a87ad7bb134834bfa732939c06e523e1ca81d161e6d628c7da0adc290832d191d5c66f9aa80b9a7097',
            'encryptedPassWord' => '5aaae845004b40e1133f7c7428500e11836b648aebf3dbbf22b6a570649c3b0db7d4bc47c5a28b7a7ba3f1fac7e5cc4e9b1a0efce66627db241a15a1b9e1f7662432509ac9493d52bfdbc055fa8ab7730a89749aa75bc8fb6f76fff5cefdc95c82fc6dc69a8fc187e238b1b9cdbfcd226e730c19e99d708d92e3960517c9bd79',
            'loginName' => 'ysjlabs',
            'passWord' => 'yakeun87!@'));

        $data = [
            'encryptedLoginName'=> '75af1daa73e96bf48beaf632088af7d65d4b26d39ed4c6be2705ca2be7fbe31a87bee07c30e6d95a6800f7e25d837ce6766a45a345b9ca6e36359070577e2e5c8146f532d110a9f7a15838b5e8d6c32e51b72bc0f65ab8f8187d216e28381a92cca716bbbf25a818cf4dd95b4c0ef46bf1318599a6456c666002cefee094b17e',
            'encryptedPassWord'=> '58186cc9c573d9061b9d505b2745be8b98351f05a6aac6c62845a41cd044889e2f3f5f595359b98a29f709abe1092dd58341a3d7260545d1eb5aafc0efad5f73aeedbeaa453923a53a8a7d57a42da8195de1c076e314dd4099336007fb418a9d8fc08034c6591720018d508b924626cdcce7f8d82dedfe0f67ab65e6eb3e053a',
            'priority'=> 93,
            'authMethod'=> 'login',
            'returnURL'=> 'http://soffice.11st.co.kr?ts=1596181197873',
            'loginName'=> 'ysjlabs',
            'passWord' => 'yakeun87!@',
        ];

        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/logincheck.tmall', $data);

        $data = [
            'method' => 'getQnaTempListJSON'
        ];

        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/AuthUnityBoardAction.tmall', $data);

        $data = [
            'method' => 'getProductQnaSellerListJSON',
            'start'=> 0,
            'limit'=> 300, // get 300
            'prdNoBox' => '',
            'sltTxtGubun'=> 'name',
            'searchQnaDtlsCd' => '',
            'answerStatus' => '',
            'srchTxt' => '',
            'startDate'=> $start_date,
            'endDate'=> $end_date,
            'periodPart'=> '01',
            'supplyCmNo'=> 'undefined',
            'searchClsf'=> 'NORMAL',
            'ntCodeType' => '',
            'trnsStatCd'=> '',
            'isPaging'=> 'Y'
        ];
        //prdNoBox: 2619767173
        // lấy tổng số câu hỏi    
        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/AuthUnityBoardAction.tmall', $data);
        $dataQuestions = $client->getResponse()->getContent();
        $dataQuestions = substr($dataQuestions, 1);
        $dataQuestions = substr($dataQuestions, 0,-1);
        $dataQuestions = json_decode($dataQuestions, true);
        
        if ($dataQuestions['BOARD_LIST']) {
            foreach ($dataQuestions['BOARD_LIST'] as $items) {
                $result = $this->_model->loadRecords('question', ['inquiryId' => trim($items['subInfoNo']),'channel_name'=>'11ST']);
                $data = [
                    'question_name' => trim($items['memberBO']['memID']),
                    'question_content' => trim($items['unityBoardInfoBO']['unityBoardInfoContentBO']['brdInfoCont']),
                    'question_created' => trim($items['unityBoardInfoBO']['createDt']),
                    'dealId' => $items['unityBoardInfoBO']['brdInfoClfNo'], //$items['subInfoNo'],
                    'channel_name' => '11ST',
                    'inquiryId' => $items['subInfoNo'], //$items['productBO']['prdNo']
                    'isDelete' => 0
                ];
                if (!empty($items['answerCont'])) {
                    $data['question_status'] = 2;
                    $data['reply_name'] = trim($items['answerCont']);
                    $data['reply_created'] = trim($items['answerDt']);
                }

                if ($result) {
                    $this->_model->updateRecord('question', $data, ['inquiryId' => trim($items['subInfoNo']) ,'channel_name'=>'11ST']);
                } else {
                    $this->_model->insertRecord('question', $data);
                }
            }
        }
    }

    public function replyQuestionAction($inquiryId, $content){
        $client = new Client(HttpClient::create(['timeout' => 60]));
        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/login.tmall?returnURL=http://soffice.11st.co.kr');
        $form = $crawler->selectButton("로그인")->form();
        $crawler = $client->submit($form, array(
            'encryptedLoginName' => '5c9930fcf66bf5d4fe8803db86387a427b56b013452be0c765b9011d179c105f38f590019b05ee1503dcf5ed29dcda81b9b641603b34cf7a927c9f3e5fc8202b6db9e4d7b9963d75994f8623a46d5971f80b5d186cd982a87ad7bb134834bfa732939c06e523e1ca81d161e6d628c7da0adc290832d191d5c66f9aa80b9a7097',
            'encryptedPassWord' => '5aaae845004b40e1133f7c7428500e11836b648aebf3dbbf22b6a570649c3b0db7d4bc47c5a28b7a7ba3f1fac7e5cc4e9b1a0efce66627db241a15a1b9e1f7662432509ac9493d52bfdbc055fa8ab7730a89749aa75bc8fb6f76fff5cefdc95c82fc6dc69a8fc187e238b1b9cdbfcd226e730c19e99d708d92e3960517c9bd79',
            'loginName' => 'ysjlabs',
            'passWord' => 'yakeun87!@'));

        $data = [
            'encryptedLoginName'=> '75af1daa73e96bf48beaf632088af7d65d4b26d39ed4c6be2705ca2be7fbe31a87bee07c30e6d95a6800f7e25d837ce6766a45a345b9ca6e36359070577e2e5c8146f532d110a9f7a15838b5e8d6c32e51b72bc0f65ab8f8187d216e28381a92cca716bbbf25a818cf4dd95b4c0ef46bf1318599a6456c666002cefee094b17e',
            'encryptedPassWord'=> '58186cc9c573d9061b9d505b2745be8b98351f05a6aac6c62845a41cd044889e2f3f5f595359b98a29f709abe1092dd58341a3d7260545d1eb5aafc0efad5f73aeedbeaa453923a53a8a7d57a42da8195de1c076e314dd4099336007fb418a9d8fc08034c6591720018d508b924626cdcce7f8d82dedfe0f67ab65e6eb3e053a',
            'priority'=> 93,
            'authMethod'=> 'login',
            'returnURL'=> 'http://soffice.11st.co.kr?ts=1596181197873',
            'loginName'=> 'ysjlabs',
            'passWord' => 'yakeun87!@',
        ];

        $crawler = $client->request('POST', 'https://login.11st.co.kr/auth/front/selleroffice/logincheck.tmall', $data);

        $data = [
            'method' => 'getQnaTempListJSON'
        ];

        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/AuthUnityBoardAction.tmall', $data);

        $start_date = (date("Y") - 1) . '/' .  date("m/d");
        $end_date = date("Y/m/d");

        $data = [
            'method' => 'getProductQnaSellerListJSON',
            'start'=> 0,
            'limit'=> 30,
            'prdNoBox' => '',
            'sltTxtGubun'=> 'name',
            'searchQnaDtlsCd' => '',
            'answerStatus' => '',
            'srchTxt' => '',
            'startDate'=> $start_date,
            'endDate'=> $end_date,
            'periodPart'=> '01',
            'supplyCmNo'=> 'undefined',
            'searchClsf'=> 'NORMAL',
            'ntCodeType' => '',
            'trnsStatCd'=> '',
            'isPaging'=> 'Y'
        ];

        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/AuthUnityBoardAction.tmall', $data);

        $dataQuestions = $client->getResponse()->getContent();
        $dataQuestions = substr($dataQuestions, 1, strlen($dataQuestions) -1);
        $dataQuestions = substr($dataQuestions, 0, strlen($dataQuestions) -1);
        $dataQuestions = json_decode($dataQuestions, true);

        $hgrnkBrdInfoNo = '';
        $brdInfoClfNo ='';
        $buyerId ='';

        foreach ($dataQuestions['BOARD_LIST'] as $question) {
            if ($inquiryId == $question['subInfoNo']) {
                $hgrnkBrdInfoNo = $question['unityBoardInfoBO']['brdInfoNo'];
                $brdInfoClfNo = $question['unityBoardInfoBO']['brdInfoClfNo'];
                $buyerId = $question['memberBO']['memID'];
                break;
            }
        }
        // echo $hgrnkBrdInfoNo . '-' . $brdInfoClfNo . '-' . $buyerId;
        // die();
        $data = [
            'brdInfoNo' => $inquiryId,//'148175316'
            'hgrnkBrdInfoNo' => $hgrnkBrdInfoNo,//'148097117'
            'brdInfoClfNo' => $brdInfoClfNo,//'2770257979' dealId
            'brdInfoCont' => $content,
            'brdInfoSbjct' => '',
            'method' => 'updateProductQnaAnswer',
            'buyerId' => $buyerId,//'mjdi****'
            'flag' => 'sellerPrdQna',
            'partFlag' => 'seller',
            'searchClsf' => 'NORMAL',
            'ntCodeType' => '',
            'prdNoBox' => '(unable to decode value)',
            'sltTxtGubun' => 'name',
            'srchTxt' => '',
            'searchQnaDtlsCd' => '',
            'startDate' => $start_date,
            'endDate' => $end_date,
            'sltDuration' => 'RECENT_MONTH',
            'answerStatus' => '',
            'sltQnaTemp' => '',
            'answerCont' => $content
        ];
        $crawler = $client->request('POST', 'https://soffice.11st.co.kr/product/ProductQnaUpdate.tmall', $data);
        return $crawler;
    }
}

?>