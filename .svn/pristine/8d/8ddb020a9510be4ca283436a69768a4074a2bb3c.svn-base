import React, { Component } from 'react';
import { View, Text, StyleSheet, AsyncStorage } from 'react-native';
import { Header } from 'react-native-elements';
import { Left, Right, Icon } from 'native-base';
import { ActivityIndicator, FlatList } from 'react-native';

import { data } from './define';
const server = data[0];

export default class Order extends Component {
      static navigationOptions = {
           title: 'Quản lý đơn hàng',
           headerStyle: {
             color: '#DB4437'
           },
           headerTintColor: '#DB4437',
           headerTitleStyle: {
              fontWeight: 'bold',
           },
      };

    constructor(props) {
         super(props);
         this.state = {
           dataApi: [],
           isLoading: true,
           username: "",
         };
    }
    componentDidMount() { //auto run function
           // get session
           AsyncStorage.getItem('username', (err, result) => {
                       console.log(result);
           });
          fetch(server+'orderApi.html')
             .then((response) => response.json())
             .then((responseJson) => {
                 if (responseJson.result) {
                      console.log(responseJson.list_order);
                      this.setState({ dataApi: responseJson.list_order });
                 }
             })
             .catch((error) => console.error(error))
             .finally(() => {
                  this.setState({ isLoading: false });
             });
      }


    render () {
        const { navigation } = this.props;
        console.log('api', this.state.dataAPI);
        return (
            <View style={styles.container}>
                {this.state.isLoading ? <ActivityIndicator/> : (
                     <FlatList
                          data={this.state.dataApi}
                          keyExtractor={({ id }, index) => id}
                          renderItem={({ item, index }) => (

                          <View style= {styles.contentOrder}>
                              <View style={{flex: 1, flexDirection: 'row'}}>
                                 <View style={styles.contentOrderLeft}><Text style={styles.textPurcharse}></Text></View>
                                 <View style={styles.contentOrderRight}>
                                    <Text style={styles.textbold}>T-Bridge: {item.ticketNumber}</Text>
                                    <Text style={styles.textbold}>Gmarket: {item.travelProductId}</Text>
                                    <View style={{marginTop: 10}}>
                                        <Text> {item.dealName}</Text>
                                        <Text> {item.price}M [{item.name}]</Text>
                                        <Text> {item.userName} [{item.phoneNumber}]</Text>
                                        <Text> Ngày mua: [{item.purchaseDateTime}]</Text>
                                    </View>
                                 </View>
                              </View>
                        </View>
                    )}
                    />
                )}
            </View>
        );
    }
}

const styles = StyleSheet.create({
   container: { flex: 1, padding: 10, backgroundColor: '#fff' },
   textbold: {fontWeight: 'bold'},
   textPurcharse: {width: '70%', color: '#fff', backgroundColor: '#3b5998'},
   contentOrder: {borderColor: '#ccc', borderWidth: 1, marginTop: 10, padding: 10 },
   contentOrderLeft: {width: '30%'},
   contentOrderRight: {width: '70%', left: 15 },
});
