import React, { Component } from 'react';
import { ActivityIndicator, FlatList ,BackHandler, ToastAndroid, StyleSheet, ScrollView, AsyncStorage } from 'react-native';
import { View, Text, TextInput, Button, TouchableOpacity, Dimensions } from 'react-native';

//import { Table, TableWrapper, Row } from 'react-native-table-component';
import { DataTable } from 'react-native-paper';
import Cookie from 'react-native-cookie'; //npm install react-native-cookie --save
import { LineChart } from 'react-native-chart-kit' // npm i react-native-chart-kit --save  // npm i react-native-svg --save
import Icon from 'react-native-vector-icons/FontAwesome';

import { data } from './define';
const server = data[0];

let { height } = Dimensions.get('window');
let box_count = 3;
let box_height = height / box_count;
// line chart//////////////

const screenWidth = Dimensions.get('window').width;
const chartConfig = {
  backgroundGradientFrom: "#1E2923",
  backgroundGradientFromOpacity: 0.8,
  backgroundGradientTo: "#08130D",
  backgroundGradientToOpacity: 0.5,
  color: (opacity = 1) => `rgba(26, 255, 146, ${opacity})`,
  labelColor: (opacity = 1) => `rgba(26, 255, 146, ${opacity})`,
  strokeWidth: 3, // optional, default 3
  barPercentage: 10,
  useShadowColorFromDataset: false,// optional
  decimalPlaces: 0,
};
//////////////////

export default class Main extends Component {
  constructor(props) {
     super(props);
     this.state = {
       dataApi: [],
       isLoading: true,
       searchtext: "",
       username: "",
       account_idx : "aaa",
       account_ID : "aaa",
       account_role : "aaa",
       dataChart1 : {
         labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
         datasets: [
                       {   data: [ 0, 0, 0, 0, 0, 0, 0 ] ,
                           color: (opacity = 1) => `rgba(91, 177, 217, ${opacity})`, // optional
                           strokeWidth: 3, // optional
                       },
                       {   data: [ 10, 25, 68, 20, 79, 53,24 ] ,
                           color: (opacity = 1) => `rgba(253, 209, 0, ${opacity})`, // optional
                           strokeWidth: 3 , // optional
                       },
                   ],
         legend: ["이번주" , '전주'] // optional
       },

       dataChart2 : {
         labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
         datasets: [
                       {   data: [ 0, 0, 0, 0, 0, 0 ,0] ,
                           color: (opacity = 1) => `rgba(91, 177, 217, ${opacity})`, // optional
                           strokeWidth: 3, // optional
                       },
                       {   data: [ 10, 25, 68, 20, 79, 53,67 ] ,
                           color: (opacity = 1) => `rgba(253, 209, 0, ${opacity})`, // optional
                           strokeWidth: 3 , // optional
                       },
                   ],
         legend: ["이번주" , '전주'] // optional
       }
     };
  }
  /////////////////////////////
  componentWillUnmount() {
      BackHandler.removeEventListener('hardwareBackPress', this.handleBackButton);
  }
  handleBackButton() {
      //ToastAndroid.show('Back button is pressed', ToastAndroid.SHORT);
      console.log('Back button is pressed');
      return true;
  }
  componentDidMount() { //auto run function
        BackHandler.addEventListener('hardwareBackPress', this.handleBackButton);
       // get session
       AsyncStorage.getItem('accountshopping', (err, result) => {
              var account = result;
              console.log(account);
              fetch(server+'dashboardApi.html', {
                   method: 'POST',
                   headers: {
                     Accept: 'application/json',
                     'Content-Type': 'application/json',
                   },
                   body: JSON.stringify({
                      account_idx: JSON.parse(result).account_idx,
                      account_ID: JSON.parse(result).account_ID,
                      account_role: JSON.parse(result).account_role
                   })
              })
              .then((response) => response.json())
              .then((responseJson) => {
                   console.log(responseJson);
                  if (responseJson.result) {
                       this.setState({ company_name: responseJson.company_name });
                       this.setState({ data11: responseJson.data11 });
                       this.setState({ data22: responseJson.data22 });
                       this.setState({ data33: responseJson.data33 });
                       this.setState({ data44: responseJson.data44 });
                       this.setState({ notifications: responseJson.notifications });
                       this.setState({ order_number: responseJson.order_number });
                       this.setState({ question_number: responseJson.question_number });
                       this.setState({ homqua_show: responseJson.homqua_show });
                       this.setState({ homnay_show: responseJson.homnay_show });
                       this.setState({ amountsoldrealtotal_homqua: responseJson.amountsoldrealtotal_homqua });
                       this.setState({ amountsoldrealtotal_homnay: responseJson.amountsoldrealtotal_homnay });
                       this.setState({ amountsoldusetotal_homqua: responseJson.amountsoldusetotal_homqua });
                       this.setState({ amountsoldusetotal_homnay: responseJson.amountsoldusetotal_homnay });
                       this.setState({ tong_muaxong_homqua: responseJson.tong_muaxong_homqua });
                       this.setState({ tong_muaxong_homnay: responseJson.tong_muaxong_homnay });
                       this.setState({ tong_sudung_homqua: responseJson.tong_sudung_homqua });
                       this.setState({ tong_sudung_homnay: responseJson.tong_sudung_homnay });

//                       this.state.dataChart1.datasets[0].data=responseJson.data11;
//                       this.state.dataChart1.datasets[1].data=responseJson.data22;
//                       this.state.dataChart2.datasets[0].data=responseJson.data33;
//                       this.state.dataChart2.datasets[1].data=responseJson.data44;

                  }
              })
              .catch((error) => {
                      console.log(error);
                      console.error(error);
                   })
              .finally(() => {
                   this.setState({ isLoading: false });
              });

       });
       //AsyncStorage.removeItem(SESSION_KEY);
  }

  render() {
     const { navigation } = this.props;
     const searchSubmit = () => {
        fetch(server+'orderApi.html')
           .then((response) => response.json())
           .then((responseJson) => {
               if (responseJson.result) {
                    console.log(responseJson.list_order);
                    this.setState({ dataApi: responseJson.list_order });
               }
           })
           .catch((error) => console.error(error))
           .finally(() => {
                this.setState({ isLoading: false });
           });
     };

    return (
        <ScrollView  style={styles.container}>

                <View style={{width: '100%', borderColor: '#000', borderWidth: 1, borderRadius: 5}}>
                    <View style={{height:50, borderBottom: "#ccc", borderBottomWidth: 1, paddingTop:15}}>
                       <View style={{flex: 1, flexDirection: 'row'}}>
                           <View style={{width: '30%'}} >
                               <Text style={{left: 10}}>{this.state.company_name} </Text>
                           </View>
                           <View style={{width: '65%', bottom: 5}} >
                               <TouchableOpacity activeOpacity={0.95}>
                                  <TextInput style={{borderColor: '#ccc', borderWidth: 1}} value={this.state.searchtext}
                                       onChangeText={searchtext =>
                                           this.setState({ searchtext })
                                       }
                                       ref={input => {
                                           this.textInput = input;
                                       }}  placeholder="홍길동 (name)"/>
                               </TouchableOpacity>
                           </View>
                       </View>
                    </View>
                    <View style= {{ alignItems: 'center', color: '#CCC' , height : 100 , marginTop: 10 }}>
                        <View style={{flex: 1, flexDirection: 'row'}}>
                            <View style={styles.textContentResult} >
                                <TouchableOpacity activeOpacity={0.95} onPress={() => {navigation.navigate('Order', { id: 100, title: 'hello' });}} >
                                    <Text style={styles.textResult}>{this.state.order_number} 건</Text>
                                    <Text style={{ fontWeight: 'bold'}}> 미사용 티켓 수량</Text>
                                    </TouchableOpacity>
                            </View>
                            <View style={styles.textContentResult} >
                                <TouchableOpacity activeOpacity={0.95} onPress={() => {navigation.navigate('Question', { id: 120 });}} >
                                    <Text style={styles.textResult}>{this.state.question_number} 건</Text>
                                    <Text style={{ fontWeight: 'bold'  }}> 미답변 문의 수</Text>
                                </TouchableOpacity>
                            </View>
                        </View>
                    </View>
                    <View style= {{  color: '#CCC', margin: 10 }}>
                        <Text style={{fontSize: 16, fontWeight: 'bold', alignItems: 'center' }}>판매현황</Text>
                    </View>
                    <View style={{ height: 1, width: '100%', borderRadius: 1, borderWidth: 0.5, borderColor: '#000' }}></View>
                                  <View style= {{  color: '#CCC' , height : 150, marginTop: 20 }}>
                                      <View style={{flex: 1, flexDirection: 'row'}}>
                                         <View style={[styles.boxTicket, styles.boxTicket3]}></View>
                                         <View style={[styles.boxTicket5, styles.boxTicket4]}><Text>어제 {this.state.homqua_show}</Text></View>
                                         <View style={[styles.boxTicket5, styles.boxTicket4]}><Text>오늘 {this.state.homnay_show}</Text></View>
                                      </View>
                                      <View style={{flex: 1, flexDirection: 'row'}}>
                                          <View style={[styles.boxTicket, styles.boxTicket1]}><Text>실판매금액</Text></View>
                                          <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.amountsoldrealtotal_homqua}</Text></View>
                                          <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.amountsoldrealtotal_homnay}</Text></View>
                                      </View>
                                      <View style={{flex: 1, flexDirection: 'row'}}>
                                        <View style={[styles.boxTicket, styles.boxTicket1]}><Text>사용처리금액</Text></View>
                                        <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.amountsoldusetotal_homqua}</Text></View>
                                        <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.amountsoldusetotal_homnay}</Text></View>
                                      </View>
                                      <View style={{flex: 1, flexDirection: 'row'}}>
                                        <View style={[styles.boxTicket, styles.boxTicket1]}><Text>판매티켓수</Text></View>
                                        <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.tong_muaxong_homqua}</Text></View>
                                        <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.tong_muaxong_homnay}</Text></View>
                                      </View>
                                      <View style={{flex: 1, flexDirection: 'row'}}>
                                          <View style={[styles.boxTicket, styles.boxTicket1]}><Text>사용완료티켓수</Text></View>
                                          <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.tong_sudung_homqua}</Text></View>
                                          <View style={[styles.boxTicket5, styles.boxTicket2]}><Text>{this.state.tong_sudung_homnay}</Text></View>
                                      </View>
                                </View>

         <View style= {{  color: '#CCC', margin: 10 }}>
             <Text style={{fontSize: 16, fontWeight: 'bold', alignItems: 'center' }}>주간 구매수량 추이</Text>
         </View>
                    <View style= {{padding: 10, width: '100%', alignItems: 'center', justifyContent: 'center', color: '#CCC'}}>
                       <LineChart
                         data={this.state.dataChart1}
                         width={screenWidth-20}
                         height={220}
                         chartConfig={chartConfig}
                       />
                    </View>
                    <View style= {{  color: '#CCC', margin: 10 }}>
                         <Text style={{fontSize: 16, fontWeight: 'bold', alignItems: 'center' }}>주간 이용수량 추이</Text>
                     </View>
                    <View style= {{padding: 10, width: '100%', alignItems: 'center', justifyContent: 'center', color: '#CCC'}}>
                       <LineChart
                         data={this.state.dataChart2}
                         width={screenWidth-20}
                         height={220}
                         chartConfig={chartConfig}
                       />
                    </View>
                     <View style= {{padding: 10, width: '100%', alignItems: 'center', justifyContent: 'center', color: '#CCC'}}>
                                               <TouchableOpacity activeOpacity={0.95} style={styles.button} onPress={() => {navigation.navigate('Order');}} >
                                                   <Text style={styles.text}>주문내역 전체보기 > </Text>
                                               </TouchableOpacity>
                                         </View>

                    <View style={{width: 45,  position: 'absolute', right: 5, top: 10}}>
                        <Icon.Button style={{ backgroundColor: '#DB4437', height: 30}}
                           name='search'
                           onPress={searchSubmit}
                        >
                        </Icon.Button>
                    </View>
                </View>
            </ScrollView >

    );
  }

};

 const styles = StyleSheet.create({
  container: { flex: 1, padding: 5, paddingTop: 30, backgroundColor: '#fff' },
  header: { height: 50, backgroundColor: '#537791' },
  dataWrapper: { marginTop: -1 },
  row: { height: 40, backgroundColor: '#E7E6E1' },
  boxTicket: {
          height: 30,
          width: '40%',
          paddingTop: 4,
          paddingLeft:2
      },
      boxTicket5: {
          height: 30,
          width: '30%'
      },
      boxTicket1: {
          backgroundColor: '#ccc',
          borderColor: '#000',
          borderWidth: 0.5
      },
      boxTicket2: {
          borderColor: '#000',
          borderWidth: 0.5
      },
      boxTicket3: {
          backgroundColor: '#fff'
      },
      boxTicket4: {
      backgroundColor: '#CCC',
          borderColor: '#000',
          borderWidth: 0.5
      },
      parent: {
          width: 300,
          height: 500,
          backgroundColor: 'red',
          margin: 50,
      },
      button: {
          flexDirection: 'row',
          height: 50,
          alignItems: 'center',
          justifyContent: 'center',
          marginTop: 52,
          color: '#DB4437',
          borderColor: '#DB4437',
          borderWidth: 1,
          borderRadius: 10,
          textDecorationLine: 'none',
          bottom: 30
      },
      text: {
          color: '#DB4437',
          fontSize: 16,
          fontWeight: 'bold',
          padding: 80
      },
      textContentResult: {
          marginLeft: 8,
          width: '46%',
          height: 100,
          borderColor: '#000',
          borderWidth: 0.5,
          alignItems: 'center',
          justifyContent: 'center'
      },
      textResult: {
          fontSize: 18,
          fontWeight: 'bold',
          textDecorationLine: 'underline',
          textDecorationStyle: 'solid',
          textDecorationColor: '#000'
      },
});
